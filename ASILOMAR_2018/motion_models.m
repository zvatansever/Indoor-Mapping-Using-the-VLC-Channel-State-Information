clc;clear all;close all;randn('seed',999)
print_figures=1
%% VLC PART
max_range = 20;
map_width = 100;
map_height = 20;
xWall=[0 100 100 80 80 0 0];
yWall=[0 0 100 100 20 20 0];

dt = 1; %timing interval
robotPos = [2 1.5 0]';% robot initial state
mu1 = robotPos; % initial state of the robot
sigma1 = [0.0001 0 0;0 0.0001 0; 0 0 0.0001]; % initial position is certain

VLC_noise=0;
%% Noise

sV = 0.01;  %noise of the actual translational speed of the robot
sW = 0.05*pi/180; %Noise on the actual angular speed of the robot
sRange = 0.2; % range measurement noise
sAngle =.50*pi/180; % bearing noise
sSignature = 0.001; % signature noise
%% VLC noise covariances
R = [0.03 0 0;
    0 0.03 0;
    0 0 0.005]; % Covariance movement [x,y,theta]
Q = [0.3 0 0;
    0 1.0 0;
    0 0 0.4]; % Covariance measurements [range;bearing;signature]
%% control signal


U3=[ 70*pi/180*ones(1,1) 1e-10*ones(1,25)...
    -65*pi/180*ones(1,1) -1e-10*ones(1,55),...
    -5*pi/180*ones(1,1) 1e-10*ones(1,45),...
    -22*pi/180*ones(1,1) -1e-10*ones(1,65),...
    85*pi/180*ones(1,1) 1e-10*ones(1,30),...
    35*pi/180*ones(1,1) 1e-10*ones(1,30),...
    -10*pi/180*ones(1,1) 1e-10*ones(1,30),...
    15*pi/180*ones(1,1) 1e-10*ones(1,30),...
    10*pi/180*ones(1,1) 1e-10*ones(1,30),...
    -18*pi/180*ones(1,1) 1e-10*ones(1,30)];


% U3=[ 90*pi/180*ones(1,1) 1e-10*ones(1,20)...
%      -90*pi/180*ones(1,1) 1e-10*ones(1,20)...
%      -90*pi/180*ones(1,1) 1e-10*ones(1,20)...
%      90*pi/180*ones(1,1) 1e-10*ones(1,20)...
%      90*pi/180*ones(1,1) 1e-10*ones(1,20)...
%      -90*pi/180*ones(1,1) 1e-10*ones(1,20)...
%      -90*pi/180*ones(1,1) 1e-10*ones(1,20)...
%      90*pi/180*ones(1,1) 1e-10*ones(1,20)...
%      90*pi/180*ones(1,1) 1e-10*ones(1,20)...
%      -90*pi/180*ones(1,1) 1e-10*ones(1,20)...
%      -90*pi/180*ones(1,1) 1e-10*ones(1,20)...
%      90*pi/180*ones(1,1) 1e-10*ones(1,20)...
%      90*pi/180*ones(1,1) 1e-10*ones(1,20)...
%      -90*pi/180*ones(1,1) 1e-10*ones(1,20)...
%      -90*pi/180*ones(1,1) 1e-10*ones(1,20)...
%      90*pi/180*ones(1,1) 1e-10*ones(1,20)...
%      90*pi/180*ones(1,1) 1e-10*ones(1,20)...
%      -90*pi/180*ones(1,1) 1e-10*ones(1,20)...
%      -90*pi/180*ones(1,1) 1e-10*ones(1,20)...
% ]
% U3=[ 0*pi/180*ones(1,1) 1e-10*ones(1,190)...
%      -90*pi/180*ones(1,1) 1e-10*ones(1,20)...
%      -90*pi/180*ones(1,1) 1e-10*ones(1,190)...
    %-65*pi/180*ones(1,1) -1e-10*ones(1,55),...
% ];
%  U3=[75*pi/180*ones(1,1) 1e-10*ones(1,18)];
%  U3=[45*pi/180*ones(1,1) 1e-10*ones(1,18)];

U=[0.5*ones(1,length(U3));U3];
%% main loop
for cmd = 1:size(U,2)
    display(sprintf('Iteration %d',cmd));
    robotPos = robot_step(robotPos,U(:,cmd),sV,sW,dt);
    veh_true(:,cmd)=robotPos;
    if print_figures
        figure(1)
        plot(xWall, yWall, '-k','linewidth',3)
        hold on;
       
        plot(robotPos(1), robotPos(2), 'bo')
        line([robotPos(1) robotPos(1)+0.5*cos(robotPos(3))], [robotPos(2) robotPos(2)+0.5*sin(robotPos(3))], 'color', 'b')
        xlim([-5 105]);ylim([-5 105]);
                pause(0.05);
        
    end

    
end


 save square veh_true 